{% extends 'base.html' %}
{% block content %}

<h3 class="mb-3">Open Games</h3>
{% if open_games %}
  {% for g in open_games %}
    {% set away_spread = (0 - g.spread_line) if g.spread_line is not none else None %}
    <div class="card mb-3 game-card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="text-muted small">{{ g.start_time.strftime('%Y-%m-%d %H:%M') }}</div>
          <a class="btn btn-sm btn-primary" href="{{ url_for('game_detail', game_id=g.id) }}">Details</a>
        </div>

        <!-- column labels aligned with odds grid -->
        <div class="odds-grid text-uppercase text-muted small fw-bold mb-1">
          <div></div> <!-- empty slot for team names -->
          <div class="text-center">ML</div>
          <div class="text-center">Spread</div>
          <div class="text-center">Total</div>
        </div>

        <!-- odds grid (top row = AWAY, bottom row = HOME) -->
        <div class="odds-grid">
          <!-- teams -->
          <div class="og-team">
            <div class="team-name">{{ g.away_team }}</div>
            <div class="team-name">{{ g.home_team }}</div>
          </div>

          <!-- moneyline -->
          <div class="og-market">
            <div class="odds-pill js-odds-pick"
                 data-game-id="{{ g.id }}"
                 data-bet-type="ML"
                 data-selection="AWAY"
                 data-label="{{ g.away_team }}"
                 data-price="{{ g.ml_away }}">
              {% if g.ml_away is not none %}
                <div class="odds-line">{{ '+' if g.ml_away > 0 else '' }}{{ g.ml_away }}</div>
              {% else %}<div class="text-muted">—</div>{% endif %}
            </div>
            <div class="odds-pill js-odds-pick"
                 data-game-id="{{ g.id }}"
                 data-bet-type="ML"
                 data-selection="HOME"
                 data-label="{{ g.home_team }}"
                 data-price="{{ g.ml_home }}">
              {% if g.ml_home is not none %}
                <div class="odds-line">{{ '+' if g.ml_home > 0 else '' }}{{ g.ml_home }}</div>
              {% else %}<div class="text-muted">—</div>{% endif %}
            </div>
          </div>

          <!-- spread -->
          <div class="og-market">
            <div class="odds-pill js-odds-pick"
                 data-game-id="{{ g.id }}"
                 data-bet-type="SPREAD"
                 data-selection="AWAY"
                 data-label="{{ g.away_team }}"
                 data-line="{{ away_spread }}"
                 data-price="{{ g.spread_away_odds }}">
              {% if g.spread_line is not none and g.spread_away_odds is not none %}
                <div class="odds-line">{{ '+' if away_spread > 0 else '' }}{{ away_spread }}</div>
                <div class="odds-price">{{ g.spread_away_odds }}</div>
              {% else %}<div class="text-muted">—</div>{% endif %}
            </div>
            <div class="odds-pill js-odds-pick"
                 data-game-id="{{ g.id }}"
                 data-bet-type="SPREAD"
                 data-selection="HOME"
                 data-label="{{ g.home_team }}"
                 data-line="{{ g.spread_line }}"
                 data-price="{{ g.spread_home_odds }}">
              {% if g.spread_line is not none and g.spread_home_odds is not none %}
                <div class="odds-line">{{ g.spread_line }}</div>
                <div class="odds-price">{{ g.spread_home_odds }}</div>
              {% else %}<div class="text-muted">—</div>{% endif %}
            </div>
          </div>

          <!-- totals -->
          <div class="og-market">
            <div class="odds-pill js-odds-pick"
                 data-game-id="{{ g.id }}"
                 data-bet-type="TOTAL"
                 data-selection="OVER"
                 data-label="Over {{ g.total_points }}"
                 data-price="{{ g.over_odds }}">
              {% if g.total_points is not none and g.over_odds is not none %}
                <div class="odds-line">o{{ g.total_points }}</div>
                <div class="odds-price">{{ g.over_odds }}</div>
              {% else %}<div class="text-muted">—</div>{% endif %}
            </div>
            <div class="odds-pill js-odds-pick"
                 data-game-id="{{ g.id }}"
                 data-bet-type="TOTAL"
                 data-selection="UNDER"
                 data-label="Under {{ g.total_points }}"
                 data-price="{{ g.under_odds }}">
              {% if g.total_points is not none and g.under_odds is not none %}
                <div class="odds-line">u{{ g.total_points }}</div>
                <div class="odds-price">{{ g.under_odds }}</div>
              {% else %}<div class="text-muted">—</div>{% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
{% else %}
<p class="text-muted">No open games at the moment.</p>
{% endif %}

<hr class="my-4">

<h3 class="mb-3">Past Games</h3>
{% if past_games %}
<table class="table table-sm table-hover">
  <thead><tr><th>Matchup</th><th>Start</th><th>Status</th><th>Moneyline</th><th>Spread</th><th>Total</th><th></th></tr></thead>
  <tbody>
    {% for g in past_games %}
    <tr>
      <td><strong>{{ g.away_team }}</strong> @ <strong>{{ g.home_team }}</strong></td>
      <td>{{ g.start_time.strftime('%Y-%m-%d %H:%M') }}</td>
      <td>{{ g.status }}</td>
      <td>{% if g.ml_home is not none and g.ml_away is not none %}HOME {{ g.ml_home }} / AWAY {{ g.ml_away }}{% else %}—{% endif %}</td>
      <td>{% if g.spread_line is not none %}{{ g.home_team }} {{ g.spread_line }} (H {{ g.spread_home_odds }}, A {{ g.spread_away_odds }}){% else %}—{% endif %}</td>
      <td>{% if g.total_points is not none %}{{ g.total_points }} (O {{ g.over_odds }}, U {{ g.under_odds }}){% else %}—{% endif %}</td>
      <td><a class="btn btn-outline-secondary btn-sm" href="{{ url_for('game_detail', game_id=g.id) }}">View</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p class="text-muted">No past games yet.</p>
{% endif %}

{% endblock %}
